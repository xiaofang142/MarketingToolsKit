# 项目规则配置

## 自动部署规则

### 自动Git提交规则

1. **自动提交触发条件**
   - 当项目文件发生修改、新增或删除时自动触发
   - 每次Trae AI执行完任务后自动触发
   - 支持的文件类型：所有源代码文件、配置文件、文档文件
   - 忽略的文件：node_modules、dist、日志文件等（遵循.gitignore规则）

2. **自动提交配置**
   - 提交频率：每10分钟检查一次变更，如有变更则自动提交
   - 提交分支：当前工作分支
   - 提交信息格式：`[Auto Commit] 自动保存 - YYYY-MM-DD HH:MM:SS`
   - 包含变更统计：自动统计修改、新增、删除的文件数量

3. **自动提交流程**
   ```
   1. 检查工作目录是否干净
   2. 如有变更，执行git add .
   3. 生成标准格式的提交信息
   4. 执行git commit -m "[Auto Commit] 自动保存 - 2025-12-26 14:30:00"
   5. 记录提交日志到.trae/logs/auto-commit.log
   ```

4. **例外情况处理**
   - 大型文件变更（单个文件超过10MB）：自动跳过，记录到日志
   - 敏感文件变更：根据.gitignore规则自动忽略
   - 合并冲突：暂停自动提交，等待手动解决
   - 远程仓库不可达：重试3次，每次间隔5分钟

5. **自动推送配置**
   - 推送频率：每30分钟自动推送一次
   - 推送分支：当前工作分支
   - 推送策略：强制推送保护（禁止--force推送）
   - 失败重试：失败后重试3次，每次间隔10分钟

6. **日志记录**
   - 自动提交日志：.trae/logs/auto-commit.log
   - 自动推送日志：.trae/logs/auto-push.log
   - 日志保留期限：30天
   - 日志格式：包含时间戳、操作类型、变更统计、结果状态

7. **手动干预机制**
   - 可以通过命令`trae auto-commit disable`临时禁用自动提交
   - 可以通过命令`trae auto-commit enable`重新启用自动提交
   - 可以通过命令`trae auto-commit now`立即执行一次自动提交

## 代码规范规则

### 代码风格
- 遵循ESLint + Prettier配置
- 缩进：2个空格
- 单引号优先
- 每行不超过100个字符

### 提交规范
- 提交信息应清晰描述变更内容
- 支持的前缀：feat、fix、docs、style、refactor、test、chore
- 示例：`feat: 添加自动提交功能`

## 安全规则

### 敏感信息保护
- 自动检测并忽略包含敏感信息的文件
- 支持的敏感信息类型：API密钥、密码、私钥等
- 检测规则：基于正则表达式匹配

### 依赖安全
- 定期检查依赖包漏洞
- 自动生成漏洞报告
- 建议升级不安全的依赖版本

## 性能规则

### 构建优化
- 自动检测构建性能问题
- 提供构建优化建议
- 支持增量构建配置

### 代码性能
- 检测潜在的性能瓶颈
- 提供代码优化建议
- 支持性能测试配置

## 测试规则

### 自动测试触发
- 代码变更后自动运行相关测试
- 支持单元测试、集成测试、端到端测试
- 测试结果自动报告

### 测试覆盖率
- 自动计算测试覆盖率
- 提供覆盖率报告
- 支持覆盖率阈值配置

## 部署规则

### 自动部署触发条件
- 主分支（main/master）有新的提交时自动触发
- 标签发布时自动触发
- 可以通过Webhook手动触发

### 部署环境
- 开发环境：自动部署所有分支
- 测试环境：自动部署测试分支
- 生产环境：仅手动触发或标签发布时触发

### 部署流程
1. 拉取最新代码
2. 安装依赖
3. 运行构建
4. 运行测试
5. 部署到目标服务器
6. 运行健康检查
7. 发送部署通知

### 回滚机制
- 支持一键回滚到上一版本
- 自动生成回滚脚本
- 回滚后自动运行健康检查

## 监控规则

### 性能监控
- 自动监控应用性能
- 支持CPU、内存、磁盘、网络监控
- 性能指标异常时自动告警

### 错误监控
- 自动捕获应用错误
- 生成错误报告
- 支持错误分级告警

### 日志监控
- 自动收集应用日志
- 支持日志分析和搜索
- 异常日志自动告警

## 协作规则

### 分支管理
- 主分支：main/master
- 开发分支：develop
- 特性分支：feature/*
- 修复分支：fix/*
- 发布分支：release/*
- 热修复分支：hotfix/*

### 合并规则
- 必须通过Pull Request合并
- 必须通过代码审查
- 必须通过所有测试
- 必须达到覆盖率要求

### 代码审查规则
- 至少1人审查
- 审查时间不超过24小时
- 必须解决所有审查意见
- 支持自动化审查工具

## 文档规则

### 文档更新
- 代码变更时必须更新相关文档
- 支持自动生成API文档
- 支持文档版本管理

### 文档格式
- 遵循Markdown格式
- 支持自动生成目录
- 支持文档搜索

## 变更管理规则

### 变更记录
- 自动生成变更日志
- 支持基于标签的变更记录
- 支持自定义变更记录格式

### 版本管理
- 遵循语义化版本规范
- 自动生成版本号
- 支持标签管理

### 发布管理
- 支持发布计划
- 支持发布审批流程
- 支持发布通知

## 备份规则

### 数据备份
- 自动备份数据库
- 支持定时备份
- 支持增量备份
- 备份保留期限：30天

### 代码备份
- 自动备份到多个远程仓库
- 支持异地备份
- 备份频率：每日一次

### 配置备份
- 自动备份配置文件
- 支持配置版本管理
- 支持配置回滚

## 合规规则

### 许可证检查
- 自动检查依赖包许可证
- 支持许可证兼容检查
- 生成许可证报告

### 代码扫描
- 自动进行代码质量扫描
- 支持安全漏洞扫描
- 支持合规性检查

### 审计日志
- 自动记录所有操作
- 支持审计日志查询
- 日志保留期限：1年

## 自定义规则

### 扩展机制
- 支持自定义规则插件
- 支持规则优先级配置
- 支持规则组合

### 规则验证
- 自动验证规则有效性
- 支持规则测试
- 支持规则调试

### 规则更新
- 支持规则自动更新
- 支持规则版本管理
- 支持规则回滚

# 规则生效时间

所有规则从配置完成后立即生效。规则变更后，需要重新加载配置才能生效。

# 规则管理命令

- `trae rules list` - 列出所有规则
- `trae rules enable <rule>` - 启用指定规则
- `trae rules disable <rule>` - 禁用指定规则
- `trae rules update` - 更新规则配置
- `trae rules test <rule>` - 测试指定规则

# 规则示例

```yaml
# 示例：自定义自动提交规则
auto_commit:
  enabled: true
  interval: 10m
  commit_message: "[Auto Commit] 自动保存 - {timestamp}"
  exclude: ["node_modules", "dist", "*.log"]
  include: ["*.js", "*.vue", "*.md", "*.json"]
```